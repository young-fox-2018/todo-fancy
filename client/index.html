<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Hacktiv To Do</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <style>
        body {
            min-height: 75rem;
            padding-top: 6rem;
        }
    </style>
    <script>
        window.fbAsyncInit = function() {
        FB.init({
            appId      : '266928807286927',
            cookie     : true,
            xfbml      : true,
            version    : 'v3.2'
        });
            
        FB.AppEvents.logPageView();   
            
        };
    
        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
        });

        function checkLoginState() {
            FB.getLoginStatus(function(response) {
                statusChangeCallback(response);
            });
        }
    </script>
</head>
<body onload="cekToken()">
    
    <div class="navbar navbar-light fixed-top" style="background-color: #e3f2fd;">
        <span class="navbar-brand">
            <img src="./logo.jpeg" class="rounded" style="width: 50px; height: auto;" />
            <span><b>Zainal To Do</b></span>
        </span>
        <div class="form-inline mt-2 mt-md-0">
            <!-- <form action="">
                <div class="input-group">
                    <input class="form-control" type="text" placeholder="Search Task" id="searchRepo" autocomplete="off" />
                    <span class="input-group-append">
                        <button class="btn btn-outline-info" type="submit" id="buttonSearchRepo">
                            <i class="fa fa-search"></i>
                        </button>
                    </span>
                </div>
            </form> -->
            <span class="button-login">
                <fb:login-button 
                    scope="public_profile,email"
                    onlogin="checkLoginState();"
                >
                </fb:login-button>
                <button class="btn btn-outline-info" onclick="cekToken()">
                    <i class="fa fa-user"></i> login
                </button>
            </span>
            <span class="button-logout" style="display: none;">
                <button class="btn btn-outline-info" id="headerEmail"></button>
                <button class="btn btn-outline-info" onclick="logout()">
                    <i class="fa fa-user-alt-slash"></i> Logout
                </button>
            </span>
        </div>
    </div>

    <div class="container-fluid row" id="loadBody"></div>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header"></div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                    <span class="button-footer"></span>
                    <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="./script.js"></script>
    <script>
        function statusChangeCallback(response) {
            $.ajax({
                method: 'GET',
                url: `http://localhost:3000/users/verify-facebook/${response.authResponse.accessToken}`,
            })
                .done(function(response) {
                    localStorage.setItem('token-todo-fancy', response.token);
                    cekToken();
                })
                .fail(function(error) {
                    console.log(error);
                });
        }
    </script>

</body>
</html>